\documentclass[FM,BP]{tulthesis}
% tento dokument používá balíky specifické pro XeLaTeX a lze jej přeložit
% jen XeLaTeXem, nemáte-li instalována použitá (komerční) písma, změňte
% nebo vymažte příkazy \set...font na následujících řádcích

\newcommand{\verze}{1.10}

\usepackage{polyglossia}
\setdefaultlanguage{czech}
\usepackage{xevlna}

\usepackage{makeidx}
\makeindex

% fonty
\usepackage{fontspec}
\usepackage{xunicode}
\usepackage{xltxtra}
% \setmainfont[Mapping=tex-text,BoldFont={* Bold},Numbers=OldStyle]{Baskerville 10 Pro}
% \setsansfont[Mapping=tex-text,BoldFont={* Bold},Numbers=OldStyle]{Myriad Pro}
% \setmonofont[Scale=MatchLowercase]{Vida Mono 32 Pro}

% příkazy specifické pro tento dokument
\newcommand{\argument}[1]{{\ttfamily\color{\tulcolor}#1}}
\newcommand{\argumentindex}[1]{\argument{#1}\index{#1}}
\newcommand{\prostredi}[1]{\argumentindex{#1}}
\newcommand{\prikazneindex}[1]{\argument{\textbackslash #1}}
\newcommand{\prikaz}[1]{\prikazneindex{#1}\index{#1@\textbackslash #1}}
\newenvironment{myquote}{\begin{list}{}{\setlength\leftmargin\parindent}\item[]}{\end{list}}
\newenvironment{listing}{\begin{myquote}\color{\tulcolor}}{\end{myquote}}
\sloppy

% deklarace pro titulní stránku
\TULtitle{Rozpoznávání emocí v audio nahrávkách s využitím hlubokých neuronových sítí}{}
\TULauthor{Tomáš Petříček}

% pro bakalářské, diplomové a disertační práce
\TULprogramme{B2646}{}{}
\TULbranch{1802T007}{Informační technologie}{Information technology}
\TULsupervisor{Ing. Lukáš Matějů Ph.D.}
\TULyear{2021}

% Vložil Koprnický, použití bibLateXu
% BibLaTeX settings
\usepackage[ 
backend=biber
%,style=iso-authoryear
,style=iso-numeric
%,style=numeric
%,sortlocale=cs_CZ
,autolang=other
,bibencoding=UTF8
%,urldate=edtf
]{biblatex}
\addbibresource{citations.bib} % vložení seznamu literárních zdrojů v bib formátu / input of references in bib format

%%%%%%%%%%%%%%%%%%%%%%%%%%
% Formátování podle pokynů FZS, čárka mezi jmény a poslední jméno se spojkou „a“
% při volbě iso-authoryear, 
\DeclareDelimFormat{multinamedelim}{\addcomma\space}

\DeclareDelimFormat{finalnamedelim}{%
  \ifnumgreater{\value{liststop}}{2}{\finalandcomma}{}%
  \addspace\bibstring{and}\space}

\DeclareNameAlias{author}{family-given/given-family} 
% kulaté závorky kolem citačního záznamu použitím \parencite{}
% nebo použitím standardního příkazu \cite{} s touto redefinicí \let\cite\parencite
%%%%%%%%%%%%%%%%%%%%%%%%%%

% Hranaté závorky kolem čísel v seznamu literatury při použitém iso-numeric
\DeclareFieldFormat{labelnumberwidth}{\mkbibbrackets{#1}}

\usepackage{csquotes} %užití biblatexu hlasí warnings, důvodem může být použití českých uvozovek v citacích! / solving of problems with Czech quotations
\urlstyle{same} %sazba url odkazů stejným fontem jako ostatní text, řešení problémů v zalamování hypertextových odkazů v citacích / url in references seting into the same form as text 

\begin{document}

\ThesisStart{male}
%\ThesisStart{zadani-a-prohlaseni.pdf}

\begin{abstractCZ}
\end{abstractCZ}

\begin{keywordsCZ}
\end{keywordsCZ}

\vspace{2cm}

\begin{abstractEN}
\end{abstractEN}

\begin{keywordsEN}
\end{keywordsEN}

\clearpage

\begin{acknowledgement}
\end{acknowledgement}

\tableofcontents

\clearpage

\begin{abbrList}
\end{abbrList}

\chapter{Úvod}
Mluvení je nám nejpřirozenější forma komunikace a emoce nám pomáhají si lépe porozumět. Díky emocím můžeme svému okolí ukázat svůj vnitřní psychologický stav. Při používání jiných forem komunikace je těžší vyjádřit své emoce, ale i přesto lidé našli způsoby, jak je do komunikace zapojit. S rozvojem chatovácích platforem byly vyvinuty smajlíky, které reprezentují zjednodušený výraz lidského obličeje. Můžeme, tak ve zprávě poslat úplnější informaci a lépe si porozumět.\cite{DBLP:journals/speech/AkcayO20}

Nicméně i přesto, že jsme schopni vyjádřit své emoce, tak to neznamená, že se pochopíme. Emoce jsou subjektivní a každý z nás je může vnímat trochu jinak. Tato vlastnost emocí neusnadňuje vývoj systémů pro jejich rozpoznávání. Zatím nebyl vyvinut způsob, jak emoce měřit. Proto lidé usilují o vyvinutí systémů schopných rozpoznávat emoce bez explicitně zadaných instrukcí.

Modely strojového učení jsou schopné najít skryté vzory v datech a naučit se je rozdělovat. Pro učení modelu pro rozpoznávání emocí lze použít data získaná z textu, změn výrazu tváře, hlasu, gest nebo držení těla.\cite{konar_chakraborty_2015} Modely založené na rozpoznávání emocí z řeči mohou najít uplatnění na příklad při vývoji virtuálních asistentů. 

V posledních letech došlo k rozvoji osobních virtuálních asistentů jako jsou Siri a Alexa, které jsou používány pro hlasové ovládání elektronických zařízení. Mohou odesílat textové zprávy, přijímat telefonní hovory, přehrávat hudbu nebo vyhledávat ve webovém prohlížeči. Systém schopný rozpoznávat emoce může zlepšit komunikaci s asistentem tak, aby se nám zdála přirozenější.\cite{DBLP:journals/corr/abs-1912-10458} 

Dále může model najít uplatnění pro call centra. Data generovaná call centrem mohou posloužit k vývoji automatické obsluhy zákazníků nebo pro optimalizaci práce v call centru. \cite{konar_chakraborty_2015}

Systémy na rozpoznávání emocí nejsou rozšířené, jsou zatím ve fázi vývoje. Modely jsou trénované z velké části na uměle vytvořených datových sadách a nejsou tak ověřeny na datech z reálného. života.\cite{konar_chakraborty_2015}

Cílem této práce je nashromáždit veřejně dostupné datové sady pro rozpoznávání emocí. Zjistit metody pro získávání příznaků. Vytvořit metodu pro poskytování dat do neuronové sítě. Vytvořit model a uskutečnit několik pokusů během, kterých se budou měněny hyperparametry sítě. Následně výsledky prezentovat. Výsledky této práce mohou vést k vylepšení dosavadních technik pro rozpoznávání emocí z řeči. 

\chapter{Teoretická část}
\section{Rozpoznávání emocí}
Rozpoznávání emocí v řeči se zabývá zpracováním zvukových signálů a jejich řazením do emocionálních kategorií. Pro třídění se používají diskrétní a prostorové modely vyžadující označená data. Pro lepší rozpoznávání jsou data pro modely předzpracována. Cílem předzpracování je z dat dostat nejdůležitější informace pro rozpoznávání. Přesnost rozpoznávání může být zvýšena i zapojením dalších příznaků. U rozpoznávání řečí to mohou být příznaky vytažené z vizuální záznamu mluvčího.\cite{DBLP:journals/speech/AkcayO20}

\subsection{Emoce}
Emoce jsou popisují náš vnitřní stav. Emoce můžeme dělit diskrétně do kategorií. Teorie, která je na tom založená, dělí emoce do šesti kategorií: smutek, radost, strach, hněv, znechucení a překvapení. Dále můžeme dělit emoce rozměrově. Emoce jsou děleny do rozměrů jako je mocenství, vzrušení nebo vliv. Vzrušení udává sílu dané emoce a má rozsah od znudění k nadšení. Nevýhodou rozměrového rozdělení o proti diskrétnímu je, že není tolik intuitivní.\cite{DBLP:journals/speech/AkcayO20}

\subsection{Datové sady}
Datové sady jsou nezbytnou součástí rozpoznávání emocí. Data pro rozpoznávání musí být označkována. Datové sady mohou být rozděleny do tří hlavních kategorií podle toho, jak byla data získána. Data mohla být pořízena předstíráním, kdy herec při nahrávání předstírá, že emoci prožívá. Datové sady pořízené tímto způsobem se relativně snadno sestavují, protože tvůrci mají poměrně velkou kontrolu nad celým procesem. Tímto způsobem získaná data, ale nemusí odpovídat skutečné reálné situaci, proto existují další 2 způsoby získávání datových sad. Při získávání vybuzených datových sad je mluvčí umístěn do situace, která se velice podobá reálné situaci. Poslední způsob získávání dat pro rozpoznávání je z přirozené řeči. Data mohou být získána na příklad z rozhovorů z radií, televizních show nebo záznamů z call center. I přesto, že by tato data měla být pro rozpoznávání nejvhodnější, tak je mnohem obtížnější ji sestavit, protože se na data mohou vztahovat právní nároky.\cite{DBLP:journals/speech/AkcayO20}

Datové sady se od sebe mohou lišit také tím, kdo je namluvil. Mluvčí mohou být různého věku a pohlaví. Liší se jazykem, kterým byly namluveny a také tím, která tvrzení byla vyslovena. Počet a kategorie rozpoznávacích emocí mohou být také různé.\cite{DBLP:journals/speech/AkcayO20}

\subsection{Současné poznání}

\subsection{Zpracování dat pro rozpoznávání}
Během mluvení se emoce mluvčího mění, proto se zvukový záznam dělí do menších časových úseků. Kratší úseky nazývá rámce a mají délku v desítkách milisekund. Jednotlivé rámce lze použít pro získání příznaků pro rozpoznávání emocí. Dalším krokem zpracování je většinou okénkování, kdy je na signál použita okénkovací funkce. Na jednotlivé rámce lze použít také normalizaci, která zmírní rozdíly v řečí mezi mluvčími, ale zachová přenášenou informaci. Během nahrávání se může do nahrávky dostat ve větší míře šum, který lze při předzpracování také odstranit.\cite{DBLP:journals/speech/AkcayO20}

Dalším krokem je zvolení vhodných příznaků pro rozpoznávání. Příznaky pro rozpoznávání emocí lze rozdělit do hlavních ktogorií na prozodické příznaky, spektrální příznaky, příznaky kvality hlasu a příznaky založené na Teager Energy Operator.

Příznaky pro rozpoznávání lze rozdělit na příznaky založené na čase a příznaky založené na spektru. Mezi příznaky založené na čase patří krátkodobá energie signálu, nejvyšší amplituda nebo nejmenší energie. Je velice jednoduché tyto příznaky získat a jednoduchým způsobem reprezentují zvukové nahrávky. Na druhou stranu příznaky založené na spektru nám mohou přinést hlubší porozumění. Mezi příznaky založené na spektru patří Mel-Frequency Cepstral Coefficients, spectral centroid nebo chroma coefficients.\cite{DBLP:journals/corr/abs-1912-10458}

Mel-Frequency Cepstrum je reprezentuje krátkodobé silové spektrum zvuku za účelem napodobit lidské vnímání zvuku.

\subsubsection{Příznaky MFCC}
Technika získávání MFCC příznaků spočívá v před zvýraznění, okénkování signálu, použití Diskrétní Fourierovy transformace, použití Mel banky filtrů, logaritmizace a použití inverzní Diskrétní kosínovi transformace. Ve fázi před zvýraznění je posílena energie vysokých frekvencí signálu. 

Při okénkování je zvukový signál je nejprve rozdělen na jednotlivé posuvné rámce. Dále je signál podroben okénkování, kdy je amplituda signálu snížena na konci a na začátku rámce. Může k tomu být použíto Hammingovo nebo Hanningovo okénko. Dále signál převeden pomocí Diskrétní Fourierovi transformace do frekvenční oblasti. Na výsledné spektrum aplikujeme Mel banku filtrů, která je založena na Mel stupnici. Mel stupnice zohledňuje vnímaní zvukových frekvencí člověkem. Lidé lépe rozlišují mezi nízkými frekvencemi než mezi vysokými. Dále je signál zlogaritmován a je provedena Diskrétní kosínova transformace. \cite{hui_2019}

\subsection{Způsoby rozpoznávání emocí}
Pro rozpoznávání emocí se používají klasifikátory, které spadají do oblasti strojového učení s učitelem.\cite{DBLP:journals/speech/AkcayO20}. Modely strojové učení s učitelem vyžadují označená data. Každý vzorek musí mít štítek udávající třídu, do které patří. V případě rozpoznávání emocí musí mít každá nahrávka štítek s označením emoce.

Modely strojového učení se na datech učí parametry, kterým říkáme váhy a biasy. Parametry se během fáze učení mění. Jedna iterace trénovaní se nazývá epocha. Během každé trénovací epochy jsou mezi sebou příznaky vzorku a váhy modelu vynásobeny a je k nim přičten bias. Na konci modelu stojí aktivační funkce, která v případě klasifikace přiřadí vzorku pravděpodobnosti příslušnosti do jednotlivých tříd. Každou epochu je zjištěna ztráta modelu, která je pomocí metody gradient descent minimalizována. Výsledkem minimalizace je úprava parametrů modelu.

Každý model má také své hyperparametry, které se používají ve fázi učení.\cite{leonel_2019} Hyperparametry mohou měnit strukturu modelu, na příklad u hlubokých neuronových sítí to může být počet a šířka skrytých vrstev nebo aktivační funkce ve skryté vrstvě modelu. Další hyperparametry ovlivňují samotné učení mezi ně patří na příklad míra učení, regularizace nebo počet trénovacích epoch. Míra učení udává míru změny parametrů modelu při jejich aktualizaci. Regularizace zabraňuje přeučení.

Každý model by měl být, co nejobecnější. To znamená, že by měl dosahovat podobných výsledků jak na trénovacích datech tak na jakýkoli jiných. Když model nedostatečně zobecňuje, tak říkáme, že se underffiting. Naopak když se model učí v přílišném detailu, tak říkáme, že se přeučuje. Data jsou proto rozdělena na sadu trénovací a testovací. Model je natrénován na sadě trénovací a otestován na sadě testovací. Dobrý model je úspěšný v podobné míře na obou datových sadách. Trénovací sadu můžeme rozdělit také na sadu trénovací a validační. Validační sada se používá při trénování modelu. Na výsledcích této sady můžeme poznat dříve, jestli se model přeučuje nebo naopak, jestli se učí dostatečně. Při testování na testovací nebo validační sadě se parametry modelu nemění. 

Další způsob, jak ohodnotit model, jsou různé metriky. Důležitá metrika, která se používá při hodnocení klasifikátoru, je přesnost udávající poměr mezi správně klasifikovanými vzorky a všemi vzorky. Pro vyhodnocení modelu lze také použít matici záměny, která na jedné ose udává správnou třídu a na druhé předpovězenou třídu. Díky tomu můžeme jednoduše zjistit, jaké třídy si mezi sebou klasifikátor zaměňuje.

Existuje mnoho typů modelů pro klasifikaci jako jsou na příklad logistická regrese, Support Vector Machine, Decision Trees nebo neuronové sítě. \cite{fumo_2017} Dělí se do hlavních 2 skupin podle toho, jestli umí naučit klasifikovat lineárně nebo nelineárně. 

\section{Neuronové sítě}
Neuronové sítě jsou tvořeny vrstvami, které dělíme na lineární a nelineární. Lineární vrstvy tvoří parametry sítě. Nelineární vrstvy tvoří aktivační funkce. Abychom mohli označit neuronovou síť za hlubokou neuronovou síť, musí mít 2 a více lineární vrstvy. První vrstvě modelu říkáme vstupní vrstva a poslední vrstvě říkáme výstupní vrstva. Všem vrstvám mezi vstupní a výstupní vrstvou říkáme vrstvy skryté. Každá lineární vrstva má svojí šířku, která určuje počet neuronů ve vrstvě.

Všechny vrstvy sítě musí být derivovatelné, aby se mohl pro aktualizaci parametrů sítě použít algoritmus gradient descent. Derivace pro jednotlivé vrstvy sítě se počítají pomocí řetízkového pravidla. Během dopředného průchodu se v lineární vrstvě vynásobí váhy s příchozími příznaky a přičte se k nim bias.

Ve skrytých vrstvách se nejčastěji pro klasifikaci používá aktivační funkce ReLU, která při dopředném průchodu propustí pouze kladná čísla a všechny záporná čísla vynuluje.

Pro klasifikaci do více tříd se používá aktivační funkce Softmax. Výsledkem průchodu touto funkcí je vektor, který obsahuje pravděpodobnosti příslušnosti vzorku do jednotlivých tříd. Součet vektor je tedy roven jedné.

\subsection{Křížová entropie}
Jako hodnotící kritérium pro klasifikaci do více tříd lze použít křížovou entropii, která měří rozdíl mezi dvěma rozděleními pravděpodobnosti. Minimalizací křížové entropie minimalizujeme rozdíl mezi pravděpodobnostním rozdělením trénovacích dat a pravděpodobnostním rozdělením předpovídaných hodnot.\cite{brownlee_2020}

\subsection{Konvoluční neuronové sítě}
\subsection{Rekuretní neuronové sítě}
\subsection{Zkryté Markovovi modely}

\chapter{Praktická část}
\section{Výběr datových sad}
Datové sady byly vybrány na zásadě přehledu z vědecké článku \cite{DBLP:journals/speech/AkcayO20}. Hlavním kritériem při výběru byla dostupnost datové sady, proto byly vybrány sady bezplatné a dostupné pro vědecké účely. Ze zbylých datových sad byly vybrány pouze 3 anglické datové sady a jedna italská.

\subsection{RAVDESS}
Zkratka RAVDESS znamená Ryerson Audio-Visual Database of Emotional Speech and Song a označuje anglickou datovou sadu obsahující nahrávky řeči a písní. Spolu s nahrávkami zvuku byly pořízeny i video záznamy mluvčích. Nahrávky byly namluveny 24 herci, z kterých bylo 12 žen a 12 mužů činící datovou sadu pohlavně vyrovnanou. Mluvčí mluvili severoamerickou angličtinou. Nahrávky řeči zachycují 7 emocí: klid, radost, smutek, hněv, strach, překvapení a znechucení. Každý herec namluvil 2 tvrzení ve 2 úrovních emocionální intezity, běžnou a silnou, pro všechny emoce. Namluvené výrazy byly „Kids are talking by the door" a „Dogs are sitting by the door". Počet zvukových nahrávek řeči je celkově 1440. Každá nahrávka v datové sadě má přiřazený štítek, který udává druh nahrávky, druh emoce, emocionální intezitu, tvrzení, číslo opakování a herce, který nahrávku namluvil. Délky nhrávek se pohybují kolem 3 minut. Datové sada je dostupná buď na webových stránkách smartlaboratory.org nebo na Kaggle.com.\cite{smart_lab}

\subsection{SAVEE}
Zkratka SAVEE znamená Surrey Audio-Visual Expressed Emotion a označuje anglickou datovou sadu pro rozpoznávání emocí. Obsahuje 480 promluv a rozlišuje 7 emocí, mezi které patří hněv, znechucení, strach, radost, smutek, překvapení a neutrální stav. Byla namluvena 4 mužskými herci mluvící britskou angličtinou ve věku mezi 27 až 31 lety. Pro tvorbu datové sady bylo vybráno 15 vět z datové sady TIMIT. Kromě řeči byly při nahrávání zaznamenávány i pohyby v obličeji mluvčích, kteří na něm měli namalovány modré značky.\cite{savee}

\subsection{TESS}
Zkratka TESS znamená Toronto emotional speech set a označuje anglickou datovou sadu pro rozpoznávání emocí. Obsahuje 2800 promluv, které byly namluveny 2 herečkami ve věku 26 a 64 let. Rozlišuje 7 emocí mezi něž patří hněv, znechucení, strach, radost, překvapení, smutek a neutrální stav. Každá herečka namluvila 200 promluv pro všechny emoce. Promluva vždy začínala slovy "Say the word" a končila jedním z 200 vybraných slov.\cite{tess}

\subsection{EMOVO}
EMOVO je italská datová sada pro rozpoznávání emocí. Zvukové nahrávky byly vytvořeny 6 herci, z kterých 3 byli muži a 3 ženy. Každý herec vyslovil 14 vět pro každou emoci. Datová sada rozlišuje 7 emocí mezi něž patří znechucení, strach, hněv, radost, překvapení, smutek a neutrální stav.\cite{COSTANTINI14.591}

\section{Příprava dat}
Data byla před vstupem do neuronové sítě předzpracována. Nejprve byl sjednocen formát nahrávek. Nahrávky byly převedeny na vzorkovací frekvenci 16 kHz a byl ponechán jeden zvukový kanál. Pro převod byla použit nástroj FFmpeg, který je přístupný přes rozhraní příkazové řádky. V Pythonu lze k němu přistoupit pomocí modulu subprocess. Data byla načtena, převedena do požadovaného formátu a uložena do nových souborů. Správnost převodu byla ověřena.

Dále byly nahrávky převedeny na MFCC příznaky. K převodu byl použit nástroj HTK, který je opět přístupný z příkazové řádky. Pro převod byl použit konfigurační soubor, který na příklad upravoval délku jednotlivých rámců. Zvukové nahrávky byly načteny, převedeny a výsledné příznaky byly uloženy do binárních souborů. Struktura binárních souborů je definovaní HTK. V Pythonu byl napsán, na GitHubu zveřejněn, menší modul PyHTK pomocí, kterého lze data načíst. Správnost načtených příznaků byla také ověřena.

\chapter{Závěr}

\nocite{*}
\printbibliography[title={Použitá literatura}] % sazba seznamu citací
\addcontentsline{toc}{chapter}{Použitá literatura} % vložení nadpisu do obsahu

\end{document}
